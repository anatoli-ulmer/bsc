\chapter{Rekonstruktion}
Nach XX entspricht die im Fernfeld aufgenommene Welle der Fouriertransformierten der Austrittswelle. Könnte sowohl Amplitude als auch Phase aufgenommen werden, so ließe sich durch eine einfache Rücktransformation die Austrittswelle rekonstruieren und somit Informationen über das Objekt gewinnen. Jedoch wird mittels eines Sensors nur die Intensität der Welle aufgezeichnet, die Informationen über die Phase gehen somit verloren. Das Problem, aus dieser unvollständigen Messung die Austrittswelle zu rekonstruieren wird als das Phasenproblem bezeichnet. Zur Lösung existiert u.A. der Ansatz der Freiflug-Holographie sowie die Methode der iterativen Phasenrekonstruktion
\section{Holographie}
Angenommen neben dem Objekt, über das Informationen gewonnen werden sollen befindet sich ein weiteres (im Weiteren als Referenz bezeichnetes) Objekt im Strahl, sodass die eingehende Welle an beiden gestreut wird. Sind Objekt und Referenz Näherungsweise 2D-Objekte in einer gemeinsamen Ebene, so gilt für die Austrittswelle $\phi_1$
\begin{equation}
	\phi_1=O+R
\end{equation}
mit $O$,$R$ den Austrittswellen von Objekt und Referenz. Für die aufgenommene Intensität $I$ im Fernfeld gilt
\begin{equation}
I=\left|\mathscr{F}\left[O\right]+\mathscr{F}\left[R\right]\right|^2=\left|\tilde{O}+\tilde{R}\right|^2
\end{equation}
Wird nun auf $I$ eine inverse Fouriertransformation angewendet,

\begin{equation}
	\mathscr{F}^{-1}\left[\left|\tilde{O}+\tilde{R}\right|^2\right]=
	\mathscr{F}^{-1}\left[\tilde{O}\tilde{O}^*\right]+
	\mathscr{F}^{-1}\left[\tilde{R}\tilde{R}^*\right]+
	\mathscr{F}^{-1}\left[\tilde{R}\tilde{O}^*\right]+
		\mathscr{F}^{-1}\left[\tilde{O}\tilde{R}^*\right]
\end{equation}
so ergibt sich mit Hilfe der komplexen Konjugation der Fouriertransformation XX und des Korrelationstheorems XX
\begin{equation}
\mathscr{F}^{-1}[I]\propto \underbrace{O \otimes O + R\otimes R}_{\text{Autokorrelationen}}+\underbrace{R\otimes O+ O\otimes R}_{\text {Kreuzkorrelationen}}
\end{equation}
Die Autokorrelationen, d.h. die Korrelation von Objekt und Objekt bzw Referenz mit Referenz liegen hierbei um den Ursprung des Koordinatensystems und können in jede Richtung maximal die doppelte Größe von Objekt bzw Referenz haben. Die Kreuzkorrelationen aus Objekt und Referenz sind punktsymmetrisch zum Ursprung und haben von diesem den gleichen Abstand wie Objekt- und Referenzaustrittswelle voneinander.
Sie  entsprechen einer Faltung des Objektes mit der gespiegelten, komplex konjugierten Referenz bzw der Referenz mit einem gespiegelten, komplex konjugierten Objekt.  Ist die Referenz in guter Näherung punktförmig und lässt sich durch eine Delta-Funktion beschreiben, so ist die Kreuzkorrelation näherungsweise die Austrittswelle des Objektes. Somit können trotz der verlorenen Phaseninformationen die Austrittswelle des Objektes inklusiver der Phase wieder gewonnen werden. Dieses Verfahren wird als im weiteren als Fouriertransformations-Holografie (FTH) bezeichnet.
\subsection{Entfaltung}
Um bei ausgedehnten Referenzen eine bessere Approximation des Objektes zu erhalten, muss die Faltung zwischen Objekt und Referenz rückgängig gemacht werden. Nach  XXX entspricht die Faltung einer Multiplikation, die Inverse somit einer Division im Fourierraum. Jedoch verursachen sowohl Rauschen wie auch Singulariäten in der fouriertransformierten Referenz Probleme.

Das Problem der Entfaltung tritt in verschiedenen Bereichen auf, unter anderem in der Bildverarbeitung.
Hier ist der Prozess der Wiener Entfaltung etabliert. Hierfür wird der Wienerfilter $G$ für ein mit $H$ gefaltetes Signal $S$ mit additiven Rauschen (mit der spektralen Stärke $N$) definiert als
\begin{equation}
	G=\frac{H^* S}{\left|H\right|^2 S+N}
\end{equation}
Für Rauschen, dass nicht mit dem Signal korreliert ist stellt minimiert eine Faltung mit $G$ die mittlere quadratischen quadratische Abweichung zum rauschfreien, nicht gefalteten Original - es handelt sich somit im Sinne des mittleren quadratischen Fehlers um die ideale Entfaltung \cite{castleman1996}.

Ist das Rauschen jedoch mit dem Signal korreliert, wie dies z.B. bei Poisson-Rauschen (Shot-Noise) der Fall ist, so lässt sich eine heuristische Form des Wiener-Filters mit konstantem $N$ anwenden. Hierbei muss bei der Wahl von $N$ ein Kompromiss aus Rauschunterdrückung und Entfaltung gewählt werden.

\section{Iterative Phasenrückgewinnung}
Wäre neben der Amplitude auch Phase der Fouriertransformation der Austrittswelle bekannt, so könnte diese durch eine inverse Transformation wiederhergestellt werden. 
Da bei N komplexen Datenpunkten im Realraum die Fouriertransformation durch N Amplituden und N Phasen, also 2N Variablen dargestellt werden kann, jedoch nur N Variablen (die Fourieramplituden) gemessen werden können, ist das Problem unterbestimmt und nicht eindeutig lösbar. Kann jedoch das zu rekonstruierende Objekt im Realraum auf weniger als N/2 Bildpunkte beschränkt werden, so wird das Problem lösbar. Die räumliche Beschränkung im Realraum wird durch die Wahl eines sog. Supports, außerhalb dessen der Realraum als leer angenommen wird umgesetzt.  
Die Problemstellung ist nun im rauschfreien Fall eine Lösung der Gleichung $\rho(x)=\mathscr{F}^{-1}\tilde{\rho}(q)$ unter den Nebenbedingungen dass 1. $\rho$ auf den Support beschränkt ist und 2. die Amplituden von $\tilde{\rho}$ mit den bekannten Fourieramplituden $A(q)$ übereinstimmt.
\subsection{Algorithmen}
Ein zur Lösung der Problemstellung verwendeter Algorithmus, der Error-Reduction Algorithmus (ER) basiert auf abwechselnden Erzwingen der der Nebenbedingungen, d.h. von einem Startwert $\rho_0$ ausgehend wird zunächst $\tilde{\rho_0}$ bestimmt, die Amplitude im Fourierraum durch $A$ ersetzt, in den Realraum transformiert und dort außerhalb des Supports gleich Null gesetzt. Dies wird iterativ wiederholt, wobei sich $\rho_n$ einer beide Nebenbedingungen erfüllenden Lösung annähert.

Das Erzwingen der Nebenbedienung im Realraum kann als Projektion auf die Lösungsmenge $S$ der Nebenbedingung  mit dem Komplement $\bar{S}$ durch den Projektor $P_s$ 

 \begin{align}
 P_s\rho (x)=\begin{cases}
 \rho (x)  &\text{für } x\in S\\
 \mathbb{0}  &\text{für }x\notin S
 \end{cases}&&
 P_{\bar{s}}\rho (x)=\begin{cases}
 \mathbb{0} &\text{für } x\in S\\
 \rho (x)   &\text{für }x\notin S
 \end{cases}
 \end{align}
aufgefasst werden. Der analoge Projektor für die Erfüllung der Nebenbedingung im Fourierraum, der im Fourierraum die Amplitude von $\tilde{\rho}$ durch die bekannte Amplitude $A(q)$ ersetzt und dabei den Winkel $\Phi\left(\tilde{\rho}\left(q\right)\right)$ beibehält lautet
\begin{align}
	\tilde{P}_m \tilde{\rho}(q)&=A(q)e^{i\Phi(\tilde{\rho})}&&P_m\rho(x)=\mathscr{F}^{-1}A(q)e^{i\Phi\left(\mathscr{F}\rho\left(x\right)\right)} \,.
\end{align}

	\begin{figure}
		\centering
		\includegraphics[width=1\textwidth]{images/projektor.eps}
		\caption[Projektoren]{Verwendete Projektoren: Der Support Projektor $P_S$ projiziert auf die durch den Support beschriebene Mannigfaltigkeit, $P_{\bar{S}}$ auf das Komplement. Ein Reflektor wendet die doppelte Schrittweite wie ein Projektor an und stellt somit eine Spiegelung an der Lösungsmenge der Nebenbedingung dar. Der Fourier-Projektor stellt in Fourierraum eine Projektion auf die kreisförmige Menge der bekannten Amplituden dar.}
		\label{fig:projektoren}
	\end{figure}
	Neben den Projektoren die, den Schritt $\rho\rightarrow (\mathbb{1}+(P-\mathbb{1}))\rho$ ausführen, können auch sogenannte Reflektoren mit doppelter Schrittweite
	\begin{equation}
	R_\nu= (\mathbb{1}+2(P-\mathbb{1}))=(2P_\nu-\mathbb{1})
	\end{equation}
	eingeführt werden.
In dieser Schreibweise können auch Weiterentwicklungen wie der Hybrid Input Output (HIO) und Relaxed Averaged Alternating Reflections (RAAR) Algorithmus dargestellt werden (Anhang \ref{chap:anhang_algos}). Ihre Prinzip ist in \fref{fig:recon} graphisch dargestellt. Die Algorithmen unterscheiden sich bezüglich ihres Konvergenzverhaltens und insbesondere bezüglich ihrer Anfälligkeit für Stagnation in lokalen Minima. 
Ein Rauschen im Fourierraum, wie unvermeidbar bei der Rekonstruktion aus aufgenommenen Streubildern, bewirkt, dass keine eindeutige, exakte Lösung existieren muss, sondern nur die ein globales Minumum aufgefunden werden kann. 
	\begin{figure}
		\centering
		\includegraphics[width=1\textwidth]{images/algorithmen.eps}
		\caption[Rekonstruktionsalgorithmen]{Darstellung der Algorithmen ER, RAAR und HIO. Bei ER findet eine abwechselnde Projektion auf die Lösungsmengen der Nebenbedinungen statt. Bei ER und HIO ist der einzelne Iterationsschritt komplexer und abhängig von einem Parameter $\beta$. Abbildung für ER und HIO nach \cite{marchesini2007}, für RAAR siehe Anhang.}
		\label{fig:recon}
	\end{figure} 
\subsection{Support}
Üblicherweise ist der Bereich auf den das Objekt im Realraum beschränkt ist nicht bekannt, der für die iterativen Rekonstruktionsalgorithmen benötigten Supports muss zunächst bestimmt werden. Hierfür existieren verschiedene Möglichkeiten. Die triviale Methode besteht aus einer Festlegung aus zuvor bekannten Dimensionen des Experiments. Jedoch kann nur in Ausnahmefällen so der Support ausreichend eng gewählt werden um die Bedingung XXX zur erfüllen.
Eine verbreitete Methode, bezeichnet als Shrink-Wrap Algorithmus, ist durch eine Anpassung des Supports während der Rekonstruktion gekennzeichnet: Der zunächst geratene (für eine eindeutige Lösung des Problems  zu große) Support wird nach einer festgelegten Anzahl an Rekonstruktionsiterationen auf den Bereich beschränkt, in dem die Rekonstruierte Intensität höher als ein festgelegter Schwellwert ist. Dieser aktualisierte Support wird für weitere Iterationen genutzt und erneut aktualisiert\cite{marchesini2003}.
Die aus der Holographie gewonnene Rekonstruktion des Objektes und eine Schätzung der Referenz lassen sich zu einem Support kombinieren. Der nötige Abstandsvektor dieser Supportteile ist der  Abstandsvektor zwischen Auto- und Kreuzkorrelation (XXX).

	\begin{figure}
		\centering
		\includegraphics[width=.9\textwidth]{images/support.eps}
		\caption[Supportgenerierung]{Erzeugung des Supports. Oben: Bei verwendung von Freiflug Holographie kann die Kreuzkorrelation aus Referenz und Objekt als Support genutzt werden. Zusätzlich muss im gleichen Abstand wie Kreuz und Autokorrelation die Referenz dem Support hinzugefügt werden. Unten: Der Shrinkwrap Alorithmus beginnt mit der Autokorrelation als initalem Support und passt diesen im laufe der Rekonstruktion an.}
		\label{fig:support}
	\end{figure} 
\subsection{Eindeutigkeit der Lösung}
Das Problem der iterativen Phasenrekonstruktion ist, dass die Algorithmen keine eindeutige Lösung bereitstellen. Neben der Möglichkeit, dass die Algorithmen in einem lokalen Minimum stagnieren und dieses nicht verlassen, existiert eine weitere Quelle der Unsicherheit: Das sogenannte Zwillingsbild-Problem. Da nach \fref{eq:zwilling} das Bild $f(x,y)$ und das komplex konjugierte, punktgespiegelte "`Zwillingsbild"'  $f^*(-x,-y)$ den gleichen Betrag der Fouriertransformation besitzen, sind beides Lösungen des Problems.
\begin{equation}
\label{eq:zwilling}
	\left|\mathscr{F}[f^*(-x,-y)]\right|=\left|\mathscr{F}[f(x,y)]^*\right|=\left|\mathscr{F}[f(x,y)]\right|
\end{equation}
Dies führt dazu, dass bei einem punktsymmetrischen Support (oder einem Support, der so groß ist, dass Bild und Zwillingsbild in ihn hineinpassen) in einigen Regionen das Bild, in anderen das Zwillingsbild rekonstruiert wird (Abb. XX). Beide Probleme, Stagnation im Minimum und Zwillingsproblem, sind abhängig von der Wahl des Startpunktes der Rekonstruktion, bei zufälliger Wahl der Fourierwinkel ist die Rekonstruktion somit nicht deterministisch.

Der Shrinkwrap-Algorithmus zur Supportgewinnung kann das Zwillingsproblem in manchen Fällen umgehen, indem bei einer Dominanz von Bild oder Zwillingsbild in einem der Randbereiche des aktuellen Supports das jeweils andere bei der nächsten Anpassung des Supports unterdrückt wird und so ein nicht-punktsymmetrischer Support gefunden werden kann.
Die Supportgewinnung mittels Holographie löst dieses Problem vollständig. je nach Wahl der für den Support verwendeten Kreuzkorrelation und davon abhängiger Platzierung der Referenz im Support wird Bild oder Zwillingsbild rekonstruiert, da Objekt und Referenz zusammen nicht punktsymmetrisch sind.

Für die iterative Phasen Rekonstruktion wird häufig mehrfach mit verschiedenen, zufälligen Fourierwinkeln gestarten und ein Mittelwert aus den Rekonstruktionen gebildet (hierbei müssen die einzelnen Rekonstruktionsergebnisse hinsichtlich Translation und Punktspiegelung angepasst werden). Die Methode der Kombination aus FTH zur Supportgewinnung und anschließender IPR beginnt jedoch mit einem definierten Start (der Kreuzkorrelation) und wird nur einmalig durchgeführt. Das Ergbnis der Rekonstruktion jedes einzelnen Streubildes ist somit eindeutig und es handelt sich um ein deterministisches Verfahren.

\section{Vergleich in 2D}	
Es können nun die drei unterschiedliche Arten der Rekonstruktion verglichen werden
\begin{itemize}
\item FTH mit Entfaltung
\item IPR mit Shrinkwrap-Support
\item IPR mit FTH Support
\end{itemize}

Die Rekonstruktionsansätze werden bezüglich Ihrer Empfindlichkeit für Rauschen, Hochpass und Fehler in der Abschätzung der Referenz untersucht. Dies geschieht zunächst mit rein synthetischen 2D Bildern als Ersatz für Austrittswellen um die Funktion der drei Ansätze und ihre Limitationen zu überprüfen.

Bei idealen Bedingungen, d.h. ohne Rauschen, ohne Hochpass und mit präzise bekannter Referenz liefern alle Ansätze ein optisch vom Ausgangsbild nicht zu unterscheidendes Ergebnis (\fref{fig:recon2d-perfect})

\begin{SCfigure}
	\includegraphics[width=.48\textwidth]{images/recon2d-perfect.png}
	\caption[2D Rekonstruktion: Ideal]{Rekonstruktion mit Zentralstrahl ohne Rauschen. Oben links das theoretische Optimum, in diesem Falle das Eingangsbild, bei Streubildern mit maskierter Mitte das hochpassgefilterte Eingangsbild. Oben rechts die durch iterative Phasenrekonstruktion mit Shrinkwrap, unten links die durch Entfaltung  aus der FTH gewonnene Rekonstruktion. Unten rechts die Rekonstruktion mittels iterativer Phasenrekonstruktion und FTH als Start und Support. Zur besseren optischen Vergleichbarkeit und Interpretation sind die Rekonstruktionen hochpassgefiltert. Alle Rekonstruktionen optisch perfekte Ergebnisse.}
	\label{fig:recon2d-perfect}
\end{SCfigure}

\subsection{Einfluss Zentralmaske}
Der Einfluss des in Experimenten durch die nötige Blockierung des zentralen Strahles bedingten Hochpasses zeigt sich in \fref{fig:recon2d-mask}. Durch die Festlegung eines räumlich beschränkten Supports könnten mehr Informationen rekonstruiert werden, als durch den Hochpass nahe gelegt. Für eine korrekte Betrachtung der verlorenen Informationen muss das Eingangsbild in eine Basis aus sowohl im Real- wie auch im Fourierraum räumlich beschränkte Funktionen zerlegt werden. Nur die Komponenten, die sowohl im Fourierraum vollständig im maskierten Bereich liegen wie auch im Realraum vollständig im Support liegen können nicht wieder rekonstruiert werden. Jedoch ist die optische Beurteilbarkeit so rekonstruierter Bilder eingeschränkt. Aus diesem Grund sind die dargestellten Bilder hochpassgefiltert. Die nicht hochpassgefilterten Bilder sind im Anhang dargestellt.
\begin{figure}

	\begin{subfigure}[b]{0.48\textwidth}
		\includegraphics[width=\textwidth]{images/recon2d-mask16.png}
		\caption{kleine Maske}
	\end{subfigure}
	\hspace*{\fill}
	\begin{subfigure}[b]{0.48\textwidth}
		\includegraphics[width=\textwidth]{images/recon2d-mask64.png}
		\caption{große Maske}	
	\end{subfigure}
	\caption[2D Rekonstruktion: Beamstop]{Einfluss einer zentralen Maskierung des Streubildes mit Radius 16 Pixel bzw. 64 Pixel von 2048 Pixeln auf die Rekonstruktionen (gleiche Anordnung wie in \fref{fig:recon2d-perfect}). Z}
	\label{fig:recon2d-mask}
\end{figure}

\subsection{Einfluss Rauschen}
Zur Beurteilung des Einflusses von Rauschen auf die Rekonstruktionen werden die Fourieramplituden mit verschiedenen Auflösungen diskretisiert und ein Poisson-Rauschen angewendet. Dadurch wird das natürliche, sogenannte Shot-Rauschen bei idealer Belichtung simuliert.
\begin{figure}
	\begin{subfigure}[b]{0.45\textwidth}
		\includegraphics[width=\textwidth]{images/recon2d-mask16bit16.png}
		\caption{wenig Rauschen}
	\end{subfigure}
	\hspace*{\fill}
	\begin{subfigure}[b]{0.45\textwidth}
		\includegraphics[width=\textwidth]{images/recon2d-mask16bit14.png}
		\caption{viel Rauschen}	
	\end{subfigure}
	\caption[2D Rekonstruktion:Rauschen]{Einfluss des Rauschen: Das gering maskierte Streubild wurde mit 15\,Bit bzw 14\,Bit diskretiesiert und Poisson-Shot-Rauschen hinzugefügt.}
\end{figure}
\subsection{Einfluss Referenzabschätzung}
Sowohl für die Entfaltung wie auch für die festlegung des Supports für die iterative Rekonstruktion muss die Referenz abgeschätzt werden. Der Einfluss der Güte dieser Abschätzung..
\begin{figure}
	\begin{subfigure}[b]{0.45\textwidth}
		\includegraphics[width=\textwidth]{images/recon2d-mask16bit16error01.png}
		\caption{1\% Abweichung des Radius}
	\end{subfigure}
	\hspace*{\fill}
	\begin{subfigure}[b]{0.45\textwidth}
		\includegraphics[width=\textwidth]{images/recon2d-mask16bit16error05.png}
		\caption{5\% Abweichung des Radius}	
	\end{subfigure}
	\caption[2D Rekonstruktion: Referenz]{Einfluss von ungenauer Referenzabschätzung: Das gering verrauschte und maskierte Streubild wird mit einem andren Radius der kreisförmigen Referenz rekonstruiert. Dies hat nur einen Einfluss auf die Entfaltung.}
\end{figure}
\section{Rekonstruktion einer 3D Austrittswelle}
Die für zweidimensionale Bilder getesteten Ansätze können nun zur Rekonstruktion der Austrittswelle hinter einem dreidimensionalen Objekt eingesetzt werden. Die Dreidimensionalität des Objektes wird an dieser Stelle ignoriert und die Austrittswelle analog zu den 2D-Bildern betrachtet (\fref{fig:recon3d})

\begin{figure}
		\includegraphics[width=\textwidth]{images/recon3d.png}
	\caption[Rekonstruktion einer Austrittswelle]{Die Rekonstruktion der Austrittswelle XX. Dargestellt ist jeweils der Betrag der Abweichung von der einfallenden Wellen. Links oben das optimale Ergebnis zum Vergleich, rechts oben die Rekonstruktion mittels iterativer Rekonstruktion und Shrinkwrap, links unten mittels Entfaltung, rechts unten das Ergebnis nach iterativer Phasenrekonstruktion mit Holographie}
	\label{fig:recon3d}
\end{figure}	
Die Entfaltung wurde mit einer simulierten Austrittswelle der Referenz alleine durchgeführt. Dies setzt immernoch eine vollständig bekannte Referenz vorraus, trotzdem leidet das deutlich unter der irregulären Referenz. Die iterative Phasenrekonstruktion leidet sichtbar unter Zwillingsbildern, dieses Problem kann durch die Kombination von iterativer Phasenrekonstruktion und Holographie Umgangen werden. 
Aus der so rekonstruierten komplexen Austrittswelle der Szene ließe sich durch Rückpropagation direkt hinter das Objekt die Schärfe steigern (XXX Toli MA).
