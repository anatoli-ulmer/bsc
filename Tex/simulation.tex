\chapter{Simulation von Streubildern}
Das Problem der Berechnung synthetischer Streubilder besitzt verschiedene Lösungsansätze..
\section{Mie Streuung}
Die Mie-Theorie bietet eine analytische Lösung der Streuung an einer Kugel  in Form einer unendlichen Reihe, die numerisch ausgewertet werden kann \cite{bohren2008}. Für die Intensität beim Streuwinkel $\theta$ gilt in dieser Theorie für die Streuung unpolarisierter Strahlung in Abhängigkeit von der Brechzahl $\eta$ der Sphäre (Radius $r$) und dem Parameter $x=r/k$:
\begin{equation}
I(\theta)\propto\frac{1}{2}\left(\abs{S_1}^2+\abs{S_2}^2\right)
\end{equation} 
mit
\begin{align}
S_1=\sum_j{\frac{2n+1}{n(n+1)}(a_n\pi_n+b_n\tau_n)} &&S_2=\sum_n{\frac{2n+1}{n(n+1)}(a_n\tau_n+b_n\pi_n)}
\end{align}
wobei die Reihe bei der numerischen Auswertung nach $N$ Termen abgebrochen wird. Eine hinreichende Konvergenz liegt meist bei $N\approx2+x+4\sqrt[3]{x}$ Termen vor.  $\pi_n$ und $\tau_n$ können mit $\pi_1=1$ und  $\pi_2=3\cos{\theta}$ rekursiv über die Relationen
\begin{align}
&\pi_n=\frac{2n-1}{n-1}\cos{\theta}\pi_{n-1}-\frac{n}{n-1}\pi_{n-2}&&\tau_n=n\cos{\theta}\pi_n-(n+1)\pi_{n-1}\\
\end{align}
und $a_n$,$b_n$ über 
\begin{align}
a_n=\frac{(D_n/\eta+n/x)\psi_n-\psi_{n-1}}{(D_n/\eta+n/x)\chi_n-\chi_{n-1}} &&
b_n=\frac{(\eta D_n+n/x)\psi_n-\psi_{n-1}}{(\eta D_n+n/x)\chi_n-\chi_{n-1}}
\end{align} definiert werden. $D_n$ lässt sich rekursiv über
\begin{align}
D_{N+15}=0 && D_{n-1}=\frac{n}{\eta*x}-\frac{1}{D_n+n/(\eta x)}
\end{align}
und $\psi_n$,$\chi_n$ mittels sphärischer Besselfunktionen 1. Art ($j_n$) und 2. Art ($y_n$) als 
\begin{align}
\psi_n=x j_n&&  \chi_n=x j_n+ixy_n
\end{align}
berechnen \cite[S. 112f, 95, 127f]{bohren2008}.
Eine vektorisierte Version dieser Berechnung liegt in der auf Mätzler \cite{maetzler2002} basierten Matlab Funktion \texttt{simulation/mie.m} vor und dient der Verifizierung der Simulationsverfahren.

\section{Projektion}
	Näherung der dreidimensionalen Streuobjekte durch zweidimensionale Blenden durch Projektion. Für diese Projektionen lässt sich in Fraunhofer-Fernfeldnäherung das Streubild darstellen XXX. 
	
	Für eine kreisförmige Blende exisistiert eine analytische Darstellung der Fouriertransformation in Form der sogenannten Airy-Scheibe und das Streubild lässt sich somit mittels der Besselfunktion 1. Ordnung $J_n$ als
	\begin{equation}
	I(\theta) \propto \left ( \frac{2 J_1(kr \sin \theta)}{kr \sin \theta} \right )^2 
	\end{equation}
	berechnen\cite[S. 396]{born1980}. Für nicht kreisförmige Projektionen der Dichte lässt sich die Fouriertransformation diskret numerisch auswerten.
	Eine weitere gebräuchliche Näherung für kugelförmige Objekte ist die Rayleigh-Gans Näherung (gültig für kleine Radien und Brechzahlen nahe Vakuum). In dieser nimmt die Intensität die Form
	\begin{equation}
	    I(\theta)\propto\left ( \frac{j_1(2kr\sin(\theta/2))}{2kr\sin(\theta/2)} \right )^2 
	\end{equation}
	mit der sphärischen Besselfunktion $j_n$ an \cite[S. 163]{bohren2008}. 


\section{Multislice Fourier Transformation}
	Nach XX gilt in der ersten Bornschen Näherung für die Amplitude der gestreuten Welle
	\begin{equation}
		\phi\propto\int \delta\eta(\vec{r}) e^{-i\vec{q}\cdot \vec{r}} \dif \vec{r}
	\end{equation}
	mit $\vec{r}=(x,y,z)^T$ und  $\vec{q}=(q_x,q_y,q_z)^T$. Wird das Skalarprodukt $\vec{q}\cdot \vec{r}=xq_x+yq_yzq_z$ ausgeschrieben und die Integration über $x$ und $y$ als zweidimensionale Fouriertransformation interpretiert
	\begin{equation}
	\phi\propto\int \mathscr{F}\left[\delta\eta\right](q_x,q_y,z) e^{-zq_z} \dif z \, ,
	\end{equation}

	so lässt sich das Integral in z-Richtung als Summe interpretieren sofern sich $q_z$ als $q_z=q_\parallel(q_\perp)$ ausdrücken lässt.
	Aufgrund der Impulserhaltung muss $k_{ein}^2=k_{aus}^2=k^2$ gelten. Nach Abbildung XXX 
	\begin{align}
	k^2=(k-q_\parallel)^2+q_{\perp}^2
	\Leftrightarrow q_\parallel=k-\sqrt{k^2-q_\perp^2}
	\end{align}
	\begin{equation}
	\phi\approx\sum_n{\mathscr{F}\left[\rho_z\right] e^{-in\delta_z\left(k-\sqrt{k^2-q_\perp^2}\right) }}
	\end{equation}

	\begin{figure}
		\centering
		\includegraphics[width=0.5\textwidth]{images/msft.eps}
		\caption[Abbildungstext im Abbildungsverzeichnis]{Skizze zur Bezeichnung der Vektoren. $k_{ein}$ und $k_{aus}$ bezeichnen den Wellenvektor der einfallenden bzw. ausfallenden Welle mit dem dazwischenliegenden Winkel $\theta$. $q$ bezeichnet den Streuvektor mit einer zu $k_{ein}$ parallelen ($q_{||}$) und einer senkrechten ($q_\perp$) Komponente.. }
		\label{Abb:BspAbbildung}
	\end{figure} 

	Formel XXX beschreibt einen Algorithmus um das Streubild eines dreidimensionalen Objektes im Fernfeld in der 1. Bornschen Näherung zu berechnen. Diese Methode wird als Multislice Fourier Transformation (MSFT) bezeichnet \cite{barke2015}. Bei dieser wird Mehrfachstreuung ignoriert. Durch nachträgliches Einführen eines zusätzlichen Faktors XXX der die Absorption und Phasenänderung der Welle beim Durchlaufen des Objektes beschreibt, lässt eine grobe Näherung für Absorptionseffekte einzuführen. Eine Implementation des MSFT-Algorithmus liegt in \texttt{simulation/msft.m} vor 

\section{Multislice Propagation}
	Ein alternatives Verfahren zur Simulation XX ist in der Literatur als Multislice oder Beam Propagation bekannt \cite{hare1994}\cite{cowley1957}. Dieses Verfahren basiert auf ...
	Die Szene, deren Streubild zu berechnen ist, wird in einzelne Schichten zerlegt.
	Die Ausbreitung der in Szene einfallende ebene Welle wird genähert durch eine Vakuumpropagation von Schicht zu Schicht nach Angular Spectrum Propagation
	\begin{equation}
\bar{\phi}\left(z+\Delta z\right)=\bar{\phi}(z)e^{i\Delta z\sqrt{k^2-(q_x+q_y)^2}}\, . 	\Phi(z+\Delta z)=
	\end{equation}
	sowie eine Wechselwirkung mit der Materie der Schicht in einer einzelnen Ebene
	\begin{equation}
		\phi(z+\Delta z)=\phi e^{i\delta n \Delta z}
	\end{equation}.
	
	\begin{figure}
		\centering
		\includegraphics[width=0.75\textwidth]{images/multislice.eps}
		\caption[Abbildungstext im Abbildungsverzeichnis]{Prinzip Multislice Propagation. Die Szene wird in einzelne Schichten zerlegt und die Wechselwirkung mit der Materie jeder einzelnen Schicht in auf eine in dieser Schicht liegenden Ebene reduziert. Zwischen diesen Ebenen wird eine Vakuumpropagation angewendet.}
		\label{Abb:BspAbbildung}
	\end{figure} 
	
	(Die Näherung der Vakuumausbreitung durch einen Fresnel-Propagator bringt gegenüber der korrekten Berechnung über die Angular Spectrum Propagation keine numerischen Vorteile. Aus diesem Grund wird im Gegensatz zu \cite{hare}XXX auf diese Näherung verzichtet). 
	Bei diesem Verfahren wird die Annahme getroffen, dass  innerhalb einer Schicht die örtliche Verteilung der Materie konstant ist, sowie die durch die Propagation bedingte ... vernachlässigbar ist\cite{hare1994}. Des Weiteren wird bei der wird bei der Wechselwirkung mit der Materie der Winkel vernachlässigt XXX.
	
	Der Algorithmus zur Berechnung der Austrittswelle lautet somit
	\begin{equation}
\Phi(z+\Delta z)=
	\end{equation}
	Ist die Austrittswelle bekannt, so ist die weitere ausbreitung zum Detektor eine Vakuumpropagation, die sich entweder mittels Angular Spectrum Propagation berechnen lässt, oder sich durch eine einfache Fouriertransformation in Fraunhofer-Näherung bestimmen lässt. Ersteres Verfahren hat den Nachteil, das es bei einer numerischen Implemantion im Bereich der Szene die gleiche räumliche Rastergröße wie im Bereich des Detektors erfordert, während bei Anwendung der Fernfeld Näherung xxx
\section{Thibaults Multislice}
Thibault stellt in XX einen eigene Formulierung der Multislice-Simulation auf. Ausgehend von der Wellengleichung XX
lässt sich für die Austrittswelle XXX aufstellen.
\begin{equation}
\tilde{\Phi}(z)=\tilde{G}\ast_z\left[\tilde{\delta\eta}\ast_{q_\perp} \tilde{\Phi}\right]
\end{equation}
\begin{equation}
\tilde{G}=\frac{1}{2\pi}\frac{ik^2}{\sqrt{k^2-q_\perp^2}}e^{iz(\kappa-k)}
\end{equation}
unter der Vernachlässigung von Rückstreuung lässt sich das Faltungsintegral als in zwei Integrationsbereiche aufspalten
\begin{equation}
\tilde{\Phi}(z+\Delta z)=
\int_{\Delta z}^{\infty} \tilde{G}(z')\left[\tilde{\delta\eta}\ast_{q_\perp} \tilde{\Phi}\right](z+\Delta z-z')\dif z'
+
\int_{0}^{\Delta z} \tilde{G}(z')\left[\tilde{\delta\eta}\ast_{q_\perp} \tilde{\Phi}\right](z+\Delta z-z')\dif z'
\end{equation}
Für den ersten Summanden gilt

\begin{align*}
&\stackrel{\hphantom{z'\rightarrow z''+\Delta z}}{\hphantom{=}} 
\int_{\Delta z}^{\infty} \tilde{G}(z')\left[\tilde{\delta\eta}\ast_{q_\perp} \tilde{\Phi}\right](z+\Delta z-z')\dif z'\\
&\stackrel{z'\rightarrow z''+\Delta z}{=}
\int_{0}^{\infty} \tilde{G}(z''+\Delta z)\left[\tilde{\delta\eta}\ast_{q_\perp} \tilde{\Phi}\right](z-z'')\dif z''\\
&\stackrel{\hphantom{z'\rightarrow z''+\Delta z}}{=}
e^{i\Delta z(\kappa-k)}\int_{0}^{\infty} \frac{1}{2\pi}\frac{ik^2}{\sqrt{k^2-q^2_\perp}}e^{iz''(\kappa-k)}\left[\tilde{\delta\eta}\ast_{q_\perp} \tilde{\Phi}\right](z-z'')\dif z''\\
&\stackrel{\hphantom{z'\rightarrow z''+\Delta z}}{=}
e^{i\Delta z(\kappa-k)}\tilde{\Phi}(z) \numberthis
\end{align*}
Im zweiten Summanden kann für hinreichend kleine $\Delta z$ das Integral gut durch eine Rieman-Obersumme mit einem einzigen Stützpunkt approximiert werden:
\begin{equation}
\int_{0}^{\Delta z} \tilde{G}(z')\left[\tilde{\delta\eta}\ast_{q_\perp} \tilde{\Phi}\right](z+\Delta z-z')\dif z'
\approx
\Delta z \tilde{G}(\Delta z)\left[\tilde{\delta\eta}\ast_{q_\perp} \tilde{\Phi}\right](z)
\end{equation}
Für den Fehler 
\begin{equation}
\text{Rieman Abschätzung}
\end{equation}
Somit lässt sich in Näherung für die Welle bei $z+\Delta z$
\begin{equation}
\tilde{\Phi}(z+\Delta z)
\approx
e^{i\Delta z(\kappa-k)}
\left[
\tilde{\Phi}(z)+\frac{\Delta z}{2\pi}\frac{ik^2}{\sqrt{k^2-q^2_\perp}}
\right]
\end{equation}
Die numerische Simulation dieser Methode ist in \texttt{simulation/thibault.m} implementiert.


\section{Ergebnisse und Diskussion}
\subsection{Verifizierung}
Zur Verifizierung der vorgestellten Simulationsalgorithmen und deren numerische Implementierungen eignet sich der Vergleich der berechneten Streubilder hinter Kugeln mit den Ergebnissen aus der Berechnung mittels Mie-Streuung. Der vergleich wird für verschiedene Brechzahlen, Kugelradien und Berechnungsauflösungen bei einer Wellenlänge von 1\si{nm} durchgeführt.
Zur Quantifizierung des Vergleichs wird die Summe der Betragsquadrat der Abweichung zwischen den Simulationsdatenpunkten und der Berechnung mittels Mie verwendet.


XXWelche Paramerter?
hier Bild von Austrittswellen und Streubilder
Radialprofile
Plot der Fehler

Zur Quantifizierung der Genauigkeit der Simulationen wird die Summe der quadratischen Abweichungen der Datenpunkte der aus den Streubildern erzeugten Radialprofile von der Mie-Lösung betrachtet:


\subsection{Austrittswellen}
darstellung von interessanten austrittswellen von mehreren objekten und vgl. mit summe aus einzel austrittswellen